---
title: 闭包
createTime: 2025/10/02 15:35:13
permalink: /Python/r9mdps3n/
---



在函数嵌套中，内部函数使用了外部函数的变量，并且外部函数返回了内部函数，我们把这个**使用外部函数变量的内部函数称为闭包**
```python
def outer(logo):

  def inner(msg):
    print(f"{logo}{msg}{logo}")

  return inner

fn1 = outer("2024") # 调用outer函数, 传入logo = 2024, 返回 inner 函数并赋值给fn1
fn1("新年快乐")    # 调用 fn1（即 inner 函数），传入 msg = "新年快乐"，执行 inner 函数
# 最终输出: 2024新年快乐2024
```

## nonlocal关键字
如果内部函数需要修改外部函数的变量，则需要`nonlocal`关键字
```python
def outer(num1):
  
  def inner(num2):
    nonlocal num1
    num1 += num2
    print(num1)

  return inner

fn1 = outer(10) # 调用 outer 函数，传入 num1 = 10，返回 inner 函数并赋值给 fn1
fn1(20) # 调用 fn1（即 inner 函数），传入 num2 = 20，执行 inner 函数内部的逻辑
```

## 优缺点分析
优点:
- 无需定义全局变量即可实现函数持续的访问、修改某个值
- 闭包使用的变量的作用域是在函数内，难以被错误地调用和修改

缺点:
- 由于内部函数持续引用外部函数的值，所以会导致这一部分内存空间不被释放，一直占用着内存(**优化重点**)

